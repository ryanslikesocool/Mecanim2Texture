# Mecanim2Texture
Bake skinned mesh animations to 2D textures!

## Usage
### Texture Creator
- Drag and drop the script into your project's Editor folder
- In the top bar, select Window/ifelse/Mecanim2Texture
- Drag and drop a gameobject or prefab into the `Animation Rig` field
- The following components are required for the script to work properly.  If they are not preset, errors will appear at the bottom of the window and you will not be able to continue
    - Skinned Mesh Renderer
    - Animator (with an Animator Controller with at least one clip)
- Set the `Color Mode`
    - `LDR` exports as a `.png` and clamps colors in a 0 - 1 range, as well as rounds colors to the nearest 1/255th
    - `HDR` (highly recommended) exports as a `.exr` and does not clamp or round colors* (*it's possible that it does, but the range is extended far beyond LDR)
- Set `Bake All` if you want to bake all animations into a Texture2DArray.  Jump to Bake All if you enable this.
- Set the `FPS Capture` based on how you exported the animation from your tool of choice.  30 or 60 is recommended for animation export
- Select the `Clip to Bake`
- Review details
    - `Animations`: How many animations will be baked.  This is always 1 unless you bake all animations
    - Frames to bake: How many frames will be baked, based on `FPS Capture` and duration of `Clip to Bake`
    - Pixels to fill: How many pixels in the final texture will be filled, based on `Frames to bake` and the mesh's vertex count
    - Result texture size: The minimum power of 2 size that can fit all of the `Pixels to fill`.
    - Estimated bake time: How long the bake is estimated to take
- Click "Bake Animation".  Depending on how long the animation clip is, it could take up to a few minutes.  With about 700 vertices and a clip under 1 second it takes my computer about 1-2 seconds to generate the file
- Do not close the editor window until the texture creation is complete.  Unity has to run the animation through a coroutine to sample each frame of the animation to get all of the vertices.  If you close the window, you stop the coroutine.
#### Bake All
- If you've enabled `Bake All`, the tool will bake all textures into a Texture2DArray asset.
- You will still need to set `FPS Capture` and `Bake Scale`, both detailed above.
- Review details
    - `Result texture size` now has a 3d dimensions, relating to how many elements the Texture2DArray will have.  No matter how small an individual texture can be normally, the result will be the maximum size required.

### Mesh Baker
- Select the `Mesh` to bake into a texture.
- Click the button to bake the mesh's vertices into a texture without any animation.

### UV Mapper
- Select the `Mesh` to copy with the new UVs
- Select which `UV Layer` you want to set.  If you've already got UVs on that layer, a warning will appear
- Set a `Mesh Scale` to scale the mesh.  It's recommended to set this, even if you're scaling the mesh via shader.  Setting it properly will reduce the chance of render bounds being incorrect.
- Click on the button to clone the mesh and apply the UVs on the selected layer.

### Texture Transformer
- Select the `Texture` to transform.  The texture must have `Read/Write` enabled in the import settings.  You can uncheck the option afterwards if desired.
- Set the `Translation` (units), `Rotation` (euler angles), and `Scale` (units) values based on the offsets you want to give the texture.  If all values are 0, the texture will not change.
- Click the button to save the transformed texture.

### Shader Graph Custom Nodes (Mecanim2TexShaderGraphNodes.hlsl)
- `AnimationTexture`
- `int FrameIndex`: The frame you want to sample
- `float2 VertexIDUV`: The UV channel you baked with the vertex ids with the UV Mapper
- `int TotalFrameCount`: The frame count of the animation, so the shader knows when it has reached the end of the texture
- `Texture2D TexIn`: The texture you want to sample
- `int VertexCount`: The vertex count of the mesh
- `out float3 PosOut`: The resulting vertex positions

## Notes
- The pixels on resulting animation textures are ordered Y bottom to top, and X left to right
- Custom Shader Graph nodes are supplied in this repository for your convenience.  They are meant for use with the mesh generated by the UV Mapper
- AnimationTexturev2 is *very* buggy and slow.  It is not recommended for use
- By default, AnimationTexturev2 comes with the ability to sample 4 layers at once, but it can be modified to support however many animation layers you'd like
- Credits are appreciated, but not necessary

## Dependencies
Available in the Unity Package Manager
- Editor Coroutines (Required)
